<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTP Upload</title>
</head>
<body>
	 <h1> Back to home</h1>
    <nav>
    <a href="/">click here </a>
    </nav>

<h1>FTP Upload Interface</h1>


    <!-- Form to update FTP credentials -->
  <form id="ftp-credentials-form" action="/update_ftp_credentials/" method="post">
        <h2>Update FTP Credentials</h2>
        <label for="host">Host:</label>
        <input type="text" id="host" name="host" required><br><br>

        <label for="port">Port:</label>
        <input type="number" id="port" name="port" required><br><br>

        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br><br>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>

        <label for="remote_path">Remote Path:</label>
        <input type="text" id="remote_path" name="remote_path" required><br><br>

        <button type="submit">Update Credentials</button>
 </form>
 
 
 <p id = "credentials-message"></p>
 
<!-- Button to check FTP connection -->
<button id="check-ftp-button">Check FTP Connection</button>
<p id="ftp-status"></p>

 <!-- Form to start FTP upload -->
 <form id="ftp-upload-form">
        <button type="submit">Start FTP Upload</button>
  </form>
  <p id="upload-status"></p>

<script>
	//Hnadle ftp credentials form submission
	document.getElementById('ftp-credentials-form').addEventListener('submit', function(event) {
		event.preventDefault(); //prevent page reload
		const formData = new FormData(this);
		
        fetch('/update_ftp_credentials/',{
			method: 'POST',
			body: formData
		})
            .then(response => response.json())
            .then(data => {
                document.getElementById('credentials-message').innerText = data.message || "Error updating credentials";
            })
            .catch(error => {
                document.getElementById('credentials-message').innerText ="Failed to update credentials";
                console.error('Error:', error);
            });
    });

     // Handle FTP upload form submission
     document.getElementById('ftp-upload-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent page reload

            fetch('/start_ftp_upload/', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                document.getElementById('upload-status').innerText = data.message || "Error starting upload";
            })
            .catch(error => {
                document.getElementById('upload-status').innerText = "Failed to start FTP upload";
                console.error('Error:', error);
            });
        });  
    
    // Handle FTP connection check  
    document.getElementById('check-ftp-button').addEventListener('click', function() {
        fetch('/check_ftp_connection')
            .then(response => response.json())
            .then(data => {
                document.getElementById('ftp-status').innerText = data.message;
            })
            .catch(error => {
                document.getElementById('ftp-status').innerText = 'Error checking FTP connection.';
                console.error('Error:', error);
            });
    });
    
</script>
</body>
</html>
